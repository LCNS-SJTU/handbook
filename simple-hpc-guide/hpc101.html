

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>SJTU PI2.0-超算简明教程 &#8212; LCNS Handbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'simple-hpc-guide/hpc101';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="V2ray Client Setups" href="../v2ray/v2ray-client-101.html" />
    <link rel="prev" title="HPC Short Manual for Researcher" href="../Linux_guide.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../content.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../content.html">
                    目录
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lab routines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../%E4%BC%9A%E8%AE%AE%E6%8A%A5%E9%94%80%E6%B5%81%E7%A8%8B.html">会议报销流程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%97%A5%E5%B8%B8%E8%80%97%E6%9D%90%E6%8A%A5%E9%94%80%E6%B5%81%E7%A8%8B.html">办公用品耗材报销流程</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lab activities</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../winter_school.html">冬季班工作人员职责</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lab resources</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Linux_guide.html">HPC Short Manual for Researcher</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SJTU PI2.0-超算简明教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../v2ray/v2ray-client-101.html">V2ray Client Setups</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LCNS-SJTU/handbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LCNS-SJTU/handbook/issues/new?title=Issue%20on%20page%20%2Fsimple-hpc-guide/hpc101.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/simple-hpc-guide/hpc101.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SJTU PI2.0-超算简明教程</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">登陆超算节点</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">登陆地址</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">登陆方法</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">无密码登陆</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">文件传输</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-start">Quick Start</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#slurmjupyter-notebook">SLURM远程登录Jupyter Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bashjupyter">交互<code class="docutils literal notranslate"><span class="pre">bash</span></code>启动<code class="docutils literal notranslate"><span class="pre">jupyter</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurmjupiter">Slurm脚本启动<code class="docutils literal notranslate"><span class="pre">jupiter</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">常见问题</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sjtu-pi2-0">
<h1><a class="toc-backref" href="#id8" role="doc-backlink">SJTU PI2.0-超算简明教程</a><a class="headerlink" href="#sjtu-pi2-0" title="Permalink to this heading">#</a></h1>
<p>参考资料: <a class="reference external" href="https://docs.hpc.sjtu.edu.cn/login/index.html">PI2.0官方文档</a></p>
<p><em>Author: <a class="reference external" href="https://neoneuron.github.io">Kai Chen</a></em></p>
<nav class="contents" id="id1">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sjtu-pi2-0" id="id8">SJTU PI2.0-超算简明教程</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id9">登陆超算节点</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id10">登陆地址</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id11">登陆方法</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id12">无密码登陆</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id13">文件传输</a></p></li>
<li><p><a class="reference internal" href="#quick-start" id="id14">Quick Start</a></p></li>
<li><p><a class="reference internal" href="#slurmjupyter-notebook" id="id15">SLURM远程登录Jupyter Notebook</a></p>
<ul>
<li><p><a class="reference internal" href="#bashjupyter" id="id16">交互<code class="docutils literal notranslate"><span class="pre">bash</span></code>启动<code class="docutils literal notranslate"><span class="pre">jupyter</span></code></a></p></li>
<li><p><a class="reference internal" href="#slurmjupiter" id="id17">Slurm脚本启动<code class="docutils literal notranslate"><span class="pre">jupiter</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id7" id="id18">常见问题</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="id2">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">登陆超算节点</a><a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<section id="id3">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">登陆地址</a><a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>思源一号: <code class="docutils literal notranslate"><span class="pre">sylogin.hpc.sjtu.edu.cn</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\pi 2.0\)</span>和AI平台: <code class="docutils literal notranslate"><span class="pre">pilogin.hpc.sjtu.edu.cn</span></code></p></li>
<li><p>ARM平台(限校内IP): <code class="docutils literal notranslate"><span class="pre">armlogin.hpc.sjtu.edu.cn</span></code></p></li>
</ul>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">登陆方法</a><a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
Unix/Mac/Linux</label><div class="sd-tab-content docutils">
<p>使用内置ssh程序，通过命令行登陆hpc服务器。以下代码示例，以用户<code class="docutils literal notranslate"><span class="pre">stu438</span></code>给出</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>stu438@pilogin.hpc.sjtu.edu.cn
</pre></div>
</div>
<p>根据命令行提示符<code class="docutils literal notranslate"><span class="pre">Password</span></code>输入密码（注意，密码输入过程中，终端信息不回更新），输入完成后<code class="docutils literal notranslate"><span class="pre">Enter</span></code>确认登陆。</p>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
Windows</label><div class="sd-tab-content docutils">
<p>使用PuTTY进行登陆</p>
<p><img alt="pasted" src="../_images/pasted-image.png" /></p>
<p>运行PuTTY，在图中红框处输入服务器信息，单击蓝框处保存（以免下次使用重复输入）</p>
<p><img alt="putty" src="../_images/putty2.png" /></p>
<p>根据弹出终端窗口显示指令，输入账号密码（注意，密码输入过程中，终端信息不回更新），<code class="docutils literal notranslate"><span class="pre">Enter</span></code>登录。</p>
</div>
</div>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">无密码登陆</a><a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<p>提示: “无密码登录”仅适用于使用 SSH 命令行工具的 Linux/ UNIX / Mac 用户，Windows</p>
<blockquote>
<div><p>“无密码登录”使您无需输入用户名和密码即可登录，它还可以作为服务器的别名来简化使用。无密码登录需要建立从远程主机（集群的登录节点）到本地主机（您自己的计算机）的SSH信任关系。建立信任关系后，双方将通过 SSH 密钥对进行身份验证。</p>
</div></blockquote>
<p>首先，您需要在本地主机上生成的 SSH 密钥对。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa
</pre></div>
</div>
<p>接下来屏幕会显示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Generating<span class="w"> </span>public/private<span class="w"> </span>rsa<span class="w"> </span>key<span class="w"> </span>pair.
Enter<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>which<span class="w"> </span>to<span class="w"> </span>save<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span><span class="o">(</span>/XXX/XXX/.ssh/id_rsa<span class="o">)</span>:<span class="w">   </span><span class="c1"># 存储地址，默认回车即可</span>
Enter<span class="w"> </span>passphrase<span class="w"> </span><span class="o">(</span>empty<span class="w"> </span><span class="k">for</span><span class="w"> </span>no<span class="w"> </span>passphrase<span class="o">)</span>:<span class="w">                   </span><span class="c1"># 默认回车即可 (无密码短语模式，请注意保存您的私钥)</span>
Enter<span class="w"> </span>same<span class="w"> </span>passphrase<span class="w"> </span>again:<span class="w">                                  </span><span class="c1"># 默认回车即可 (无密码短语模式，请注意保存您的私钥)</span>
</pre></div>
</div>
<p><strong>在无密码短语的情况下，您的私钥未经加密就存储在您的硬盘上，任何人拿到您的私钥都可以随意的访问对应的SSH服务器。</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh-keygen</span></code> 将在 <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> 中生成一个密钥对，包含两个文件: <code class="docutils literal notranslate"><span class="pre">id_rsa</span></code>(需保留的私钥)，和<code class="docutils literal notranslate"><span class="pre">id_rsa.pub</span></code>(可作为您的身份发送的公钥)。</p></li>
<li><p>使用<code class="docutils literal notranslate"><span class="pre">ssh-copy-id</span></code>将本地主机的公钥<code class="docutils literal notranslate"><span class="pre">id_rsa.pub</span></code>添加到远程主机的信任列表中。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>on<span class="w"> </span>your<span class="w"> </span>PC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ssh-copy-id<span class="w"> </span>YOUR_USERNAME@TARGET_IP
</pre></div>
</div>
<p>若手动自行在服务器上添加 <code class="docutils literal notranslate"><span class="pre">authorized_keys</span></code> 文件，
将本地主机<code class="docutils literal notranslate"><span class="pre">~/.ssh/id_rsa.pub</span></code>的内容添加到远程主机的文件<code class="docutils literal notranslate"><span class="pre">~/.ssh/authorized_keys</span></code>中，</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># copy the content in ~/.ssh/id_rsa.pub in your local to ~/.ssh/authorized_keys in your remote server</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>~/.ssh
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[content from ~/.ssh/id_rsa.pub]&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/authorized_keys
</pre></div>
</div>
<p>并需确保 <code class="docutils literal notranslate"><span class="pre">authorized_keys</span></code> 文件的权限为600：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>on<span class="w"> </span>HPC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>chmod<span class="w"> </span><span class="m">700</span><span class="w"> </span>~/.ssh
<span class="o">(</span>on<span class="w"> </span>HPC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.ssh/authorized_keys
</pre></div>
</div>
</li>
</ul>
<p><img alt="ssh-copy-id" src="../_images/sshfile.png" /></p>
<p>我们还可以将连接参数写入 <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> 中，以使其简洁明了。 新建或编辑文件 <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>EDIT<span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<p>还需分配以下内容: 主机分配远程主机的别名，主机名是远程主机的真实域名或IP地址，端口分配 SSH 端口，用户分配 SSH 用户名。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Host<span class="w"> </span>hpc
<span class="w">    </span>HostName<span class="w"> </span>TARGET_IP
<span class="w">    </span>Port<span class="w"> </span>TARGET_PORT
<span class="w">    </span>User<span class="w"> </span>YOUR_USERNAME
</pre></div>
</div>
<p>您需要确保此文件的权限正确：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>on<span class="w"> </span>your<span class="w"> </span>PC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.ssh/config
</pre></div>
</div>
<p>然后，您只需输入以下内容即可登录集群：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ssh<span class="w"> </span>hpc
</pre></div>
</div>
<p>当 SSH 密钥对发生泄漏，请立即清理本地电脑 <code class="docutils literal notranslate"><span class="pre">.ssh</span></code> 文件夹里的密钥对，并重新在本地生成密钥对(生成时请设置密码短语)。另外请删除集群上的 <code class="docutils literal notranslate"><span class="pre">~/.ssh/authorized_keys</span></code> 文件。</p>
<p>如何重新生成密钥对</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>on<span class="w"> </span>HPC<span class="o">)</span><span class="w">     </span>$<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>~/.ssh/authorized_keys<span class="w">         </span><span class="c1"># 清除服务器上原有的 authorized_keys</span>
<span class="o">(</span>on<span class="w"> </span>your<span class="w"> </span>PC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>rm<span class="w">  </span>~/.ssh/id*<span class="w">                       </span><span class="c1"># 清除本地 .ssh 文件夹中的密钥对</span>
<span class="o">(</span>on<span class="w"> </span>your<span class="w"> </span>PC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w">                    </span><span class="c1"># 在本地重新生成密钥对</span>
<span class="o">(</span>on<span class="w"> </span>your<span class="w"> </span>PC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ssh-keygen<span class="w"> </span>-R<span class="w"> </span>login.hpc.sjtu.edu.cn<span class="w">  </span><span class="c1"># 清理本地 known_hosts 里关于集群的条目</span>
<span class="o">(</span>on<span class="w"> </span>your<span class="w"> </span>PC<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>ssh-copy-id<span class="w"> </span>YOUR_USERNAME@TARGET_IP<span class="w">  </span><span class="c1"># 将本地新的公钥发给服务器，存在服务器的 authorized_keys 文件里</span>
</pre></div>
</div>
</section>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">文件传输</a><a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">对于大量数据传输，集群提供如下解决方案：</p>
<ol class="arabic simple">
<li><p>少量数据传输，集群提供了专门用于数据传输的节点 (<code class="docutils literal notranslate"><span class="pre">data.hpc.sjtu.edu.cn</span></code>, <code class="docutils literal notranslate"><span class="pre">sydata.hpc.sjtu.edu.cn</span></code>)，可以直接使用 <code class="docutils literal notranslate"><span class="pre">putty</span></code>, <code class="docutils literal notranslate"><span class="pre">filezilla</span></code> 等客户端，或在本地使用 <code class="docutils literal notranslate"><span class="pre">scp</span></code>, <code class="docutils literal notranslate"><span class="pre">rsync</span></code> 命令向该节点发起传输请求（因安全策略升级，在集群的终端上不支持 <code class="docutils literal notranslate"><span class="pre">scp</span></code>/<code class="docutils literal notranslate"><span class="pre">rsync</span></code> 的远程传输功能，所以需要从用户本地终端使用 <code class="docutils literal notranslate"><span class="pre">scp</span></code>/<code class="docutils literal notranslate"><span class="pre">rsync</span></code> 命令）。</p></li>
<li><p>1TB-1PB数据传输，强烈建议您联系我们，将硬盘等存储设备送至网络信息中心进行传输。</p></li>
<li><p>超过1PB的数据，请您与我们联系，由计算专员根据具体情况为您解决数据传输问题。</p></li>
</ol>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
Unix/Mac/Linux</label><div class="sd-tab-content docutils">
<p>使用内置<code class="docutils literal notranslate"><span class="pre">scp</span></code>或<code class="docutils literal notranslate"><span class="pre">sftp</span></code>程序上传或下载文件。下面演示使用<code class="docutils literal notranslate"><span class="pre">scp</span></code>进行文件传输：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upload local folder data to the remote folder ~/tmp/ on server</span>
scp<span class="w"> </span>-r<span class="w"> </span>data/<span class="w"> </span>stu438@pilogin.hpc.sjtu.edu.cn:~/tmp/
<span class="c1"># Download ~/data.out to current local path from remote server</span>
scp<span class="w"> </span>stu438@pilogin.hpc.sjtu.edu.cn:~/data.out<span class="w"> </span>./
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">scp</span></code>的使用方法与<code class="docutils literal notranslate"><span class="pre">cp</span></code>命令类似，其他参数设定可以参考<code class="docutils literal notranslate"><span class="pre">cp</span></code>命令。</p>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
Windows</label><div class="sd-tab-content docutils">
<p>使用<code class="docutils literal notranslate"><span class="pre">WinSCP</span></code>进行文件传输。</p>
<p><img alt="winscp" src="../_images/winscp.png" /></p>
<p>按照上图红框内所示，输入设置，其中用户名与密码为hpc服务器登陆的账号密码，随后单击<code class="docutils literal notranslate"><span class="pre">保存</span></code>，单击登陆与服务器建立连接。</p>
<p><img alt="winscp2" src="../_images/winscp2.png" /></p>
<p>左侧红框内为本地文件列表，右侧蓝框内为远程服务器文件列表，可以通过鼠标拖拽的方式进行文件上传、下载。</p>
</div>
</div>
</section>
<section id="quick-start">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Quick Start</a><a class="headerlink" href="#quick-start" title="Permalink to this heading">#</a></h2>
<p><strong>在HPC服务器上通过SLURM提交Python代码，进行Tensorflow相关运算。</strong></p>
<ol class="arabic">
<li><p>登陆服务器</p></li>
<li><p>通过<code class="docutils literal notranslate"><span class="pre">scp</span></code>或WinSCP上传测试代码(例：<code class="docutils literal notranslate"><span class="pre">tf_test.py</span></code>)</p></li>
<li><p>首次登陆环境搭建</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># check availble modules</span>
module<span class="w"> </span>avail
<span class="c1"># Load module of anaconda</span>
module<span class="w"> </span>load<span class="w"> </span>miniconda3
<span class="c1"># check whether module loading is successful</span>
module<span class="w"> </span>list
<span class="c1"># setup auto-module-load in .bashrc</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;module load miniconda3&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.bashrc
<span class="c1"># conda initilization</span>
conda<span class="w"> </span>init

<span class="c1"># create a new conda env, named myenv, with python version 3.9, </span>
<span class="c1"># and install packages for sci-computing</span>
conda<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>myenv<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9<span class="w"> </span>numpy<span class="w"> </span>pandas<span class="w"> </span>scipy<span class="w"> </span>matplotlib<span class="w"> </span>jupyter<span class="w"> </span>ipykernel<span class="w"> </span>-y

<span class="c1"># activate new env</span>
conda<span class="w"> </span>activate<span class="w"> </span>myenv
<span class="c1"># add auto activation to .bashrc</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;conda activate myenv&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.bashrc

<span class="c1"># install pytorch</span>
conda<span class="w"> </span>install<span class="w"> </span>pytorch<span class="w"> </span>torchvision<span class="w"> </span>torchaudio<span class="w"> </span>pytorch-cuda<span class="o">=</span><span class="m">11</span>.7<span class="w"> </span>-c<span class="w"> </span>pytorch<span class="w"> </span>-c<span class="w"> </span>nvidia<span class="w"> </span>-y

<span class="c1"># install jupyter kernel (optional)</span>
python<span class="w"> </span>-m<span class="w"> </span>ipykernel<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>--name<span class="w"> </span>myenv<span class="w"> </span>--display-name<span class="w"> </span><span class="s2">&quot;Python (myenv)&quot;</span>
<span class="c1"># install sklearn (optional)</span>
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>scikit-learn<span class="w"> </span>-y

<span class="c1"># install tensorflow-gpu 2 (Default)</span>
pip<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>tensorflow-gpu
<span class="c1"># 若想安装tensorflow-gpu 1.15，请勿同时安装两个版本，容易出错。</span>
pip<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>tensorflow-gpu<span class="o">==</span><span class="m">1</span>.15
</pre></div>
</div>
</li>
<li><p>创建SLURM脚本</p>
<ol class="arabic simple">
<li><p>方法一：在远程服务器通过<code class="docutils literal notranslate"><span class="pre">vi/vim</span></code>直接编辑创建。</p></li>
<li><p>方法二：在本地创建纯文本文件，保存并上传。</p></li>
</ol>
<p><em>脚本范例</em> <code class="docutils literal notranslate"><span class="pre">slurm_test.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH -J xzq_test</span>
<span class="c1">#SBATCH -p dgx2</span>
<span class="c1">#SBATCH -N 1</span>
<span class="c1">#SBATCH -n 1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --gres=gpu:1</span>
<span class="c1">#SBATCH --output=%j.out</span>
<span class="c1">#SBATCH --error=%j.err</span>
<span class="c1">#SBATCH --time=00:30:00</span>
<span class="c1">#SBATCH --mail-type=end</span>
<span class="c1">#SBATCH --mail-user=your_email@sjtu.edu.cn</span>

<span class="c1"># if you want to switch working directory</span>
<span class="c1"># cd working_dir/</span>

python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import tensorflow as tf; \</span>
<span class="s2">            print(&#39;Num GPUs Available: &#39;, len(tf.config.experimental.list_physical_devices(&#39;GPU&#39;)));”</span>

<span class="s2"># run python script</span>
<span class="s2"># python test_scipt.py</span>
</pre></div>
</div>
</li>
<li><p>使用<code class="docutils literal notranslate"><span class="pre">sbatch</span></code>命令递交脚本</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>slurm_test.sh
</pre></div>
</div>
<p>终端将返回如下结果：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Submitted<span class="w"> </span>batch<span class="w"> </span>job<span class="w"> </span><span class="m">961975</span>
</pre></div>
</div>
<p>表明slurm脚本成功递交，任务id为961975。该任务号将成为查看该任务状态，并对其进行其他操作的手段。</p>
</li>
<li><p>查看脚本运行状态<code class="docutils literal notranslate"><span class="pre">sacct</span></code>命令</p>
<p>返回如下结果，通过任务id找到对应任务的状态。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="w">        </span>JobID<span class="w">    </span>JobName<span class="w">  </span>Partition<span class="w">    </span>Account<span class="w">  </span>AllocCPUS<span class="w">      </span>State<span class="w"> </span>ExitCode
------------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>--------
<span class="m">960304</span><span class="w">             </span><span class="nb">test</span><span class="w">       </span>dgx2<span class="w"> </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">     </span>FAILED<span class="w">      </span><span class="m">1</span>:0
<span class="m">960304</span>.batch<span class="w">      </span>batch<span class="w">            </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">     </span>FAILED<span class="w">      </span><span class="m">1</span>:0
<span class="m">960304</span>.exte+<span class="w">     </span>extern<span class="w">            </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">  </span>COMPLETED<span class="w">      </span><span class="m">0</span>:0
<span class="m">960467</span><span class="w">             </span><span class="nb">test</span><span class="w">       </span>dgx2<span class="w"> </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">  </span>COMPLETED<span class="w">      </span><span class="m">0</span>:0
<span class="m">960467</span>.batch<span class="w">      </span>batch<span class="w">            </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">  </span>COMPLETED<span class="w">      </span><span class="m">0</span>:0
<span class="m">960467</span>.exte+<span class="w">     </span>extern<span class="w">            </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">  </span>COMPLETED<span class="w">      </span><span class="m">0</span>:0
<span class="m">961975</span><span class="w">             </span><span class="nb">test</span><span class="w">       </span>dgx2<span class="w"> </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">    </span>RUNNING<span class="w">      </span><span class="m">0</span>:0
<span class="m">961975</span>.exte+<span class="w">     </span>extern<span class="w">            </span>acct-cfte+<span class="w">          </span><span class="m">1</span><span class="w">    </span>RUNNING<span class="w">      </span><span class="m">0</span>:0
</pre></div>
</div>
</li>
<li><p>查看运行结果</p>
<p><code class="docutils literal notranslate"><span class="pre">sacct</span></code>返回个任务状态中，<code class="docutils literal notranslate"><span class="pre">State</span></code>列可以能出现如下状态：</p>
<ul>
<li><p>RUNNING: 任务仍在运行；</p></li>
<li><p>FAILED: 任务报错，前往961975.err文件，查看错误日志</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="m">961975</span>.err
</pre></div>
</div>
</li>
<li><p>COMPLETED：任务运行结束，前往961975.out文件，查看输出结果</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span><span class="m">961975</span>.out
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="slurmjupyter-notebook">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">SLURM远程登录Jupyter Notebook</a><a class="headerlink" href="#slurmjupyter-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>参考资料:</strong> <a class="reference external" href="https://www.cnblogs.com/cookielbsc/p/12411560.html">Slurm远程登录Jupyter Notebook</a>, <a class="reference external" href="https://zhuanlan.zhihu.com/p/65130699">分享脚本远程登陆 Jupyter Notebook</a></p>
<p>使用已部署SLURM的服务器或高性能计算资源（GPU和CPU）运行<code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code>时，通常会遇到以下问题。</p>
<ul class="simple">
<li><p>通过<code class="docutils literal notranslate"><span class="pre">ssh</span></code>只能登录到slurm的登录管理节点，再通过登录节点使用slurm作业调度系统，提交slurm脚本运行作业。</p></li>
<li><p>无法再登录节点直接运行<code class="docutils literal notranslate"><span class="pre">jupyter</span></code>并通过<code class="docutils literal notranslate"><span class="pre">ssh</span></code>转发端口。</p></li>
</ul>
<p>解决方案：</p>
<ol class="arabic simple">
<li><p>通过<code class="docutils literal notranslate"><span class="pre">srun</span></code>命令申请交互<code class="docutils literal notranslate"><span class="pre">bash</span></code>，在其中运行<code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code>， 并通过<code class="docutils literal notranslate"><span class="pre">ssh</span></code>转发端口至本地。</p></li>
<li><p>通过编辑slurm脚本，通过<code class="docutils literal notranslate"><span class="pre">sbatch</span></code>发送并启动<code class="docutils literal notranslate"><span class="pre">jupyter</span></code>，同时转发至本地端口。</p></li>
</ol>
<section id="bashjupyter">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">交互<code class="docutils literal notranslate"><span class="pre">bash</span></code>启动<code class="docutils literal notranslate"><span class="pre">jupyter</span></code></a><a class="headerlink" href="#bashjupyter" title="Permalink to this heading">#</a></h3>
<ol class="arabic">
<li><p>在计算节点启动<code class="docutils literal notranslate"><span class="pre">jupyter</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># srun申请队列gpu-tesla，申请资源内存10G，1块gpu，申请打开交互bash。</span>
srun<span class="w"> </span>--partition<span class="o">=</span>gpu-tesla<span class="w"> </span>--mem<span class="o">=</span>10G<span class="w"> </span>--gres<span class="o">=</span>gpu:1<span class="w"> </span>--pty<span class="w"> </span>bash
<span class="c1"># module加载anaconda及所需gpu驱动等</span>
module<span class="w"> </span>load<span class="w"> </span>anaconda3
<span class="c1"># 激活python环境 your_env</span>
conda<span class="w"> </span>activate<span class="w"> </span>your_env
<span class="c1"># 启动jupyter，指定port（可指定其他未被占用的端口），指定ip（此处以node9为例，若登录其他节点，请使用prompt中显示的节点名称）</span>
jupyter<span class="w"> </span>notebook<span class="w"> </span>--no-browser<span class="w"> </span>--port<span class="o">=</span><span class="m">8879</span><span class="w"> </span>--ip<span class="o">=</span>node9
</pre></div>
</div>
</li>
<li><p>在本地连接<code class="docutils literal notranslate"><span class="pre">jupyter</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 8880为本地端口，node9:8879为服务器jupyter指定ip和指定端口，your_name为用户名，cluster_url为服务器ip</span>
ssh<span class="w"> </span>-N<span class="w"> </span>-L<span class="w"> </span><span class="m">8880</span>:node9:8879<span class="w"> </span>your_name@cluster_url
</pre></div>
</div>
</li>
<li><p>打开浏览器，通过<code class="docutils literal notranslate"><span class="pre">localhost:8880</span></code>访问</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 对于浏览器要求的token，复制启动jupyter后返回的信息中的token即可</span>
<span class="s2">&quot;http://127.0.0.1:8880/?token=260544***********************************dde4656&quot;</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="slurmjupiter">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Slurm脚本启动<code class="docutils literal notranslate"><span class="pre">jupiter</span></code></a><a class="headerlink" href="#slurmjupiter" title="Permalink to this heading">#</a></h3>
<ol class="arabic">
<li><p>通过<code class="docutils literal notranslate"><span class="pre">sbatch</span></code>提交任务：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>jupyter_notebook.sh
</pre></div>
</div>
</li>
<li><p>本地连接<code class="docutils literal notranslate"><span class="pre">jupyter</span></code>，并通过浏览器打开。（同交互<code class="docutils literal notranslate"><span class="pre">bash</span></code>启动<code class="docutils literal notranslate"><span class="pre">jupyter</span></code>中2-3步操作)</p>
<p>查看当前目录下log文件，找到相应服务器端口，以及<code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code>的token。</p>
<ul>
<li><p>查看<code class="docutils literal notranslate"><span class="pre">ssh</span></code>隧穿命令:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>jupyter_notebook_<span class="o">[</span>your<span class="w"> </span>slurm<span class="w"> </span>job-id<span class="o">]</span>.log<span class="p">|</span>grep<span class="w"> </span>ssh
</pre></div>
</div>
</li>
<li><p>查看<code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code> URL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>jupyter_notebook_<span class="o">[</span>your<span class="w"> </span>slurm<span class="w"> </span>job-id<span class="o">]</span>.log<span class="p">|</span>grep<span class="w"> </span><span class="m">127</span>.0.0.1
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
<p>服务器端开启 Jupyter Notebook 服务的脚本如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --partition you_partation</span>
<span class="c1">#SBATCH --nodes 1</span>
<span class="c1">#SBATCH --ntasks 1</span>
<span class="c1">#SBATCH --cpus-per-task 5</span>
<span class="c1">#SBATCH --mem-per-cpu 3G</span>
<span class="c1">#SBATCH --time 24:00:00</span>
<span class="c1">#SBATCH --job-name jupyter_notebook</span>
<span class="c1">#SBATCH --output jupyter_notebook_%J.log</span>
<span class="c1">#SBATCH --error jupyter_notebook_%J.log</span>
<span class="c1">#SBATCH --mail-user=your_email@sjtu.edu.cn</span>

<span class="c1"># get tunneling info</span>
<span class="c1"># DO NOT CHANGE</span>
<span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">port</span><span class="o">=</span><span class="k">$(</span>shuf<span class="w"> </span>-i8000-9999<span class="w"> </span>-n1<span class="k">)</span>
<span class="nv">node</span><span class="o">=</span><span class="k">$(</span>hostname<span class="w"> </span>-s<span class="k">)</span>
<span class="nv">user</span><span class="o">=</span><span class="k">$(</span>whoami<span class="k">)</span>
<span class="nv">cluster</span><span class="o">=</span><span class="k">$(</span>hostname<span class="w"> </span>-f<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s2">&quot;.&quot;</span><span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>

<span class="c1">### 在这里添加你的服务器地址</span>
<span class="nv">clusterurl</span><span class="o">=</span><span class="s2">&quot;xxx.xxx.xxx.xxx&quot;</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:~/.local/bin

<span class="c1"># print tunneling instructions jupyter-log</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">Copy macOS or linux terminal command below to create your ssh tunnel:</span>

<span class="s2">  ssh -N -L </span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">node</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">user</span><span class="si">}</span><span class="s2">@</span><span class="si">${</span><span class="nv">clusterurl</span><span class="si">}</span>
<span class="s2"> </span>
<span class="s2"> Here is the MobaXterm info:</span>

<span class="s2"> Forwarded port:same as remote port</span>
<span class="s2"> Remote server: </span><span class="si">${</span><span class="nv">node</span><span class="si">}</span>
<span class="s2"> Remote port: </span><span class="si">${</span><span class="nv">port</span><span class="si">}</span>
<span class="s2"> SSH server: </span><span class="si">${</span><span class="nv">cluster</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">clusterurl</span><span class="si">}</span>
<span class="s2"> SSH login: </span><span class="nv">$user</span>
<span class="s2"> SSH port: 22</span>

<span class="s2"> Use a Browser on your local machine to go to:</span>
<span class="s2"> localhost:</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2"> (prefix w/ https:// if using password)</span>

<span class="s2"> or copy the URL from below and put there localhost after http:// so it would be something like:</span>
<span class="s2"> http://localhost:9499/?token=86c93************************************5b2d49f</span>
<span class="s2"> &quot;</span>

<span class="c1"># DON&#39;T USE ADDRESS BELOW. </span>
<span class="c1"># DO USE TOKEN BELOW.</span>
jupyter-notebook<span class="w"> </span>--no-browser<span class="w"> </span>--port<span class="o">=</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="w"> </span>--ip<span class="o">=</span><span class="si">${</span><span class="nv">node</span><span class="si">}</span>
</pre></div>
</div>
<blockquote>
<div><p>See also: <a class="reference external" href="https://github.com/NeoNeuron/Linux-guide-for-researcher/blob/master/README.md#access-jupyter-notebook">Remote accessing Jupyter Notebook</a></p>
</div></blockquote>
</section>
</section>
<section id="id7">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">常见问题</a><a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<ol class="arabic">
<li><p>重置密码：</p>
<p>首次登陆后，建议尽快使用<code class="docutils literal notranslate"><span class="pre">passwd</span></code>命令重置密码</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>stu438@login2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>passwd
Changing<span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span>stu438.
Current<span class="w"> </span>Password:
New<span class="w"> </span>Password:
Retype<span class="w"> </span>new<span class="w"> </span>password:
passwd:<span class="w"> </span>all<span class="w"> </span>authentication<span class="w"> </span>tokens<span class="w"> </span>updated<span class="w"> </span>successfully.
</pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">密码规范</p>
<ol class="arabic simple">
<li><p>不要使用固定的常用密码</p></li>
<li><p>不要使用有意义的字符串</p></li>
<li><p>密码长度至少8位</p></li>
<li><p>密码中至少包含字母和数字</p></li>
</ol>
</div>
</li>
<li><p>服务器连接因超时或网络不稳定而断开</p>
<p><img alt="paste" src="../_images/pasted-image-2.png" /></p>
<p>在PuTTY登陆界面左侧设置选项栏中选择Connection，在右侧对应红框处，设置保持活跃时间 240。随后回到左侧Session对应服务器登陆界面，保存设置，并登陆即可。</p>
</li>
<li><p>Windows本地编辑后上传的脚本，运行报错如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch:<span class="w"> </span>error:<span class="w"> </span>Batch<span class="w"> </span>script<span class="w"> </span>contains.<span class="w"> </span>DOS<span class="w"> </span>line<span class="w"> </span>breaks<span class="w"> </span><span class="o">(</span><span class="se">\r\n</span><span class="o">)</span>
sbatch:<span class="w"> </span>error:<span class="w"> </span>instead<span class="w"> </span>of<span class="w"> </span>expected<span class="w"> </span>UNIX<span class="w"> </span>linne<span class="w"> </span>breaks<span class="w"> </span><span class="o">(</span><span class="se">\n</span><span class="o">)</span>.
</pre></div>
</div>
<p>解决方案：</p>
<p>通过vim二进制模式打开slurm脚本进行编辑。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>-b<span class="w"> </span>slurm_test.sh
</pre></div>
</div>
<p>在vim中使用命令模式替换DOS换行符</p>
<div class="highlight-vim notranslate"><div class="highlight"><pre><span></span><span class="p">:</span>%s<span class="sr">/^M/</span>/<span class="k">g</span>
</pre></div>
</div>
<p>其中^为ctrl+v, M为ctrl+m。修改完后退出vim。</p>
<div class="highlight-vim notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="k">wq</span>
</pre></div>
</div>
</li>
<li><p>文件路径问题</p>
<p>由于Windows和Linux的文件系统不同，路径的文件分割符不同。在Windows中，文件分割符通常为<code class="docutils literal notranslate"><span class="pre">\\</span></code>，而在Linux/Mac中，文件分割符为<code class="docutils literal notranslate"><span class="pre">/</span></code>。例如，</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-4">
Windows</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>D:<span class="se">\\</span>Documents<span class="se">\\</span>data<span class="se">\\</span>raw_data.npy
</pre></div>
</div>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-5">
Linux/Mac</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>/home/user/Documents/data/raw_data.npy
</pre></div>
</div>
</div>
</div>
<p>请注意区分。</p>
</li>
<li><p>任务超时被中断问题。</p>
<p>在SLURM任务脚本中，修改脚本开头脚本参数中</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --time=00:30:00</span>
</pre></div>
</div>
<ul class="simple">
<li><p>其中<code class="docutils literal notranslate"><span class="pre">00:30:00</span></code>表示最大运行运行时间30分钟，超时即会被slurm强制终止。</p></li>
<li><p>适当设定足够长的最大运行时间，可保证程序完整运行。</p></li>
<li><p>注意，<code class="docutils literal notranslate"><span class="pre">dgx2</span></code>队列单任务最大允许运行时长为7天<code class="docutils literal notranslate"><span class="pre">7-00:00:00</span></code>。</p></li>
<li><p>对于普通用户，设置过长的最大运行时间，可能导致任务长时间处于等待（PD）状态，无法正常运行。</p></li>
</ul>
</li>
<li><p>查看队列状态-<code class="docutils literal notranslate"><span class="pre">sinfo</span></code>命令</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sinfo
</pre></div>
</div>
<p><img alt="sinfo" src="../_images/sinfo.png" /></p>
<p>如上图所示，红框内为<span class="math notranslate nohighlight">\(\pi 2.0\)</span>超算中心的GPU节点，dgx2，的状态。</p>
<p>蓝框内显示队列状态：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">up</span></code>: 正常上线状态，可正常提交任务；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">down</span></code>：队列下线状态，无法接受新任务运行，已递交任务可继续运行；</p></li>
</ul>
<p>绿框内显示节点状态：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">idle</span></code>: 节点空闲状态，可正常提交任务；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">down</span></code>：节点不可用，无法提交任务；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drain</span></code>：节点根据管理员设置不可使用，无法提交任务；</p></li>
</ul>
<p>根据<code class="docutils literal notranslate"><span class="pre">sinfo</span></code>返回信息，判断是否有空闲节点计算资源，合理安排任务提交。</p>
<p>更多关于<code class="docutils literal notranslate"><span class="pre">sinfo</span></code>详细信息，参见<a class="reference external" href="https://slurm.schedmd.com/sinfo.html">sinfo原文档</a>。</p>
</li>
<li><p>查看任务状态-<code class="docutils literal notranslate"><span class="pre">squeue</span></code>命令</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">squeue</span></code>命令查看961975任务运行状态，如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>stu417@login3<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>squeue<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span><span class="m">961975</span>
<span class="w">            </span><span class="m">961975</span><span class="w">      </span>dgx2<span class="w">  </span>slurm_test<span class="w">   </span>stu438<span class="w">  </span>R<span class="w">      </span><span class="m">18</span>:18<span class="w">      </span><span class="m">1</span><span class="w"> </span>vol01
</pre></div>
</div>
<p>其中，第5列显示任务当前状态，<code class="docutils literal notranslate"><span class="pre">R</span></code>为running运行中，<code class="docutils literal notranslate"><span class="pre">PD</span></code>为pending排队中。最后一列为当前任务所在计算节点的名称。</p>
<p>更多关于<code class="docutils literal notranslate"><span class="pre">squeue</span></code>详细信息，参见<a class="reference external" href="https://slurm.schedmd.com/squeue.html">squeue原文档</a>。</p>
</li>
<li><p>取消已提交任务-<code class="docutils literal notranslate"><span class="pre">scancel</span></code>命令</p>
<p>取消 961975 任务：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scancel<span class="w"> </span><span class="m">961975</span>
</pre></div>
</div>
<p>取消<code class="docutils literal notranslate"><span class="pre">stu438</span></code>用户的所有任务：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scancel<span class="w"> </span>-A<span class="w"> </span>stu438
</pre></div>
</div>
<p>更多关于<code class="docutils literal notranslate"><span class="pre">scancel</span></code>详细信息，参见<a class="reference external" href="https://slurm.schedmd.com/scancel.html">scancel原文档</a>。</p>
</li>
<li><p>使用<code class="docutils literal notranslate"><span class="pre">srun</span></code>命令登陆计算节点，进行交互式任务递交与执行</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun<span class="w"> </span>--partition<span class="o">=</span>dgx2<span class="w"> </span>--nodelist<span class="o">=</span>vol07<span class="w"> </span>--mem<span class="o">=</span><span class="m">6000</span><span class="w"> </span>--gres<span class="o">=</span>gpu:1<span class="w"> </span>-n1<span class="w"> </span>-N1<span class="w"> </span>--pty<span class="w"> </span>--preserve-env<span class="w"> </span><span class="nv">$SHELL</span>
</pre></div>
</div>
<p>上述命令，通过<code class="docutils literal notranslate"><span class="pre">srun</span></code>登陆<code class="docutils literal notranslate"><span class="pre">dgx2</span></code>队列中的 <code class="docutils literal notranslate"><span class="pre">vol07</span></code>节点，申请1个节点(-N1)，6000MB内存(–mem=6000)、1块GPU(–gres=gpu:1)。</p>
<p>更多关于<code class="docutils literal notranslate"><span class="pre">srun</span></code>详细信息，参见<a class="reference external" href="https://slurm.schedmd.com/srun.html">srun原文档</a>。</p>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./simple-hpc-guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../Linux_guide.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">HPC Short Manual for Researcher</p>
      </div>
    </a>
    <a class="right-next"
       href="../v2ray/v2ray-client-101.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">V2ray Client Setups</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">登陆超算节点</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">登陆地址</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">登陆方法</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">无密码登陆</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">文件传输</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-start">Quick Start</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#slurmjupyter-notebook">SLURM远程登录Jupyter Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bashjupyter">交互<code class="docutils literal notranslate"><span class="pre">bash</span></code>启动<code class="docutils literal notranslate"><span class="pre">jupyter</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#slurmjupiter">Slurm脚本启动<code class="docutils literal notranslate"><span class="pre">jupiter</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">常见问题</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kai Chen
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>